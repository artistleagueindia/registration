<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Artist League Camp 2025 — Registration</title>
<style>
  :root{--bg:#0b0b10;--card:#141420;--text:#f5f7ff;--muted:#a8acc3;--accent:#5b8cff;--ok:#1db954;--warn:#ffb020}
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:980px;margin:22px auto;padding:18px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--card);border-radius:16px;padding:18px;box-sizing:border-box}
  h1{font-size:20px;margin:0 0 12px}
  label{display:block;font-size:13px;margin:10px 0 6px;color:var(--muted)}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a2a3a;background:#10101a;color:var(--text);box-sizing:border-box}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .coupon-bar{display:flex;gap:8px;align-items:center;margin-top:6px}
  .btn{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;color:#fff;background:var(--accent)}
  .btn.secondary{background:#2a2a3a}
  .btn.ok{background:var(--ok)}
  .muted{color:var(--muted);font-size:13px}
  .calc{background:#0f1320;border:1px solid #2a314b;border-radius:12px;padding:12px;margin-top:12px}
  .calc .line{display:flex;justify-content:space-between;margin:6px 0}
  .calc .total{font-weight:700;font-size:18px}
  .okmsg{margin-top:12px;padding:10px;border-radius:10px;background:#0f1f14;border:1px solid #1e7d3b}
  .errmsg{margin-top:12px;padding:10px;border-radius:10px;background:#2a1414;border:1px solid #7d1e1e}
  .file-info{font-size:13px;color:var(--muted);margin-top:8px}
  .small{font-size:12px;color:var(--muted)}
  @media (max-width:940px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="grid">
    <!-- LEFT: form -->
    <div class="card">
      <h1>Artist League Camp 2025 — Registration</h1>
      <form id="regForm" autocomplete="on" novalidate>
        <div class="row">
          <div>
            <label for="name">Name</label>
            <input id="name" name="name" required />
          </div>
          <div>
            <label for="age">Age</label>
            <input id="age" name="age" type="number" min="5" max="99" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="city">Current City</label>
            <input id="city" name="city" placeholder="" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="phone">Phone</label>
            <input id="phone" name="phone" inputmode="tel" pattern="[0-9]{10,}" title="Enter at least 10 digits" placeholder="10+ digits" required />
          </div>
          <div>
            <label for="insta">Instagram Profile Link</label>
            <input id="insta" name="insta" placeholder="https://instagram.com/…" />
          </div>
        </div>

        <label for="cop">City of Participation</label>
        <select id="cop" name="cop" required>
          <option value="">Choose…</option>
          <option value="MUMBAI">Mumbai</option>
          <option value="PUNE">Pune</option>
        </select>

        <label for="package">Choose package</label>
        <select id="package" name="package" required>
          <option value="FULL_CAMP">Full camp — ₹8499</option>
          <option value="8_CLASSES">8 classes — ₹7699</option>
          <option value="7_CLASSES">7 classes — ₹6799</option>
          <option value="6_CLASSES">6 classes — ₹5799</option>
          <option value="5_CLASSES">5 classes — ₹4799</option>
          <option value="4_CLASSES">4 classes — ₹3899</option>
          <option value="3_CLASSES">3 classes — ₹2999</option>
          <option value="2_CLASSES">2 classes — ₹2199</option>
          <option value="SINGLE_CLASS">Single class — ₹1200</option>
          <option value="AKSHAY_STAG">Akshay x Manvi (Stag) — ₹1199</option>
          <option value="AKSHAY_COUPLE">Akshay x Manvi (Couple) — ₹1999</option>
        </select>

        <label>Coupon Code (optional)</label>
        <div class="coupon-bar">
          <!-- intentionally no example text -->
          <input id="coupon" name="coupon" placeholder="" />
          <button class="btn" type="button" id="applyBtn">Apply</button>
        </div>
        <div class="muted small" style="margin-top:6px">Coupon list is private and validated server-side. Coupons apply only to full camp.</div>

        <div class="calc" id="calcBox">
          <div class="line"><span>Total fee</span><span>₹ <span id="totalFee">8499</span></span></div>
          <div class="line"><span>Discount</span><span>- ₹ <span id="discountAmt">0</span></span></div>
          <div class="line total"><span>Amount payable</span><span>₹ <span id="payAmt">8499</span></span></div>
        </div>

        <div class="okmsg" id="okMsg" style="display:none;"></div>
        <div class="errmsg" id="errMsg" style="display:none;"></div>

        <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
          <!-- Pay button: user clicks to pay. Submit button is disabled until payment succeeds. -->
          <button class="btn" type="button" id="payBtn">Pay</button>
          <button class="btn ok" type="button" id="submitBtn" disabled>Submit Registration</button>
          <button class="btn secondary" type="button" id="resetBtn">Reset</button>
        </div>
      </form>
    </div>

    <!-- RIGHT: info -->
    <div class="card">
      <h1>Payment & Info</h1>
      <div class="muted" style="margin-bottom:8px">Payment gateway: <strong>PhonePe (to integrate)</strong></div>
      <div class="muted small" id="payStatus">Not paid</div>

      <div class="calc" style="margin-top:16px">
        <div class="line"><span>Applied coupon</span><span id="appliedTag">—</span></div>
        <div class="line"><span>Payable now</span><span>₹ <span id="sidePay">8499</span></span></div>
      </div>

      <div style="margin-top:12px">
        <h3 style="margin:8px 0">About us</h3>
        <p class="small">Artist League — community-first live art education experiences across India. (Short about text. Will update full bio & logo per your assets.)</p>

        <h3 style="margin:8px 0">Terms & policies</h3>
        <p class="small">By registering you agree to our Terms & Conditions. Registrations are final — no refunds. Organizer may cancel or reschedule events; in such case a credit/alternate arrangement may be offered. Full policies will be provided on final page.</p>

        <h3 style="margin:8px 0">Contact</h3>
        <p class="small">Email: artistleagueindia@gmail.com<br>Phone: +91 9837816447</p>
      </div>

    </div>
  </div>
</div>

<script>
/* CLIENT SCRIPT
 - Replace WEB_APP_URL below with your deployed Apps Script webapp exec URL.
 - The Pay button currently simulates a successful payment (for testing).
 - TODO: integrate real PhonePe flow in startPhonePePayment() and call on success submitRegistration()
*/
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw-pHoFd7AxmfFqnPKA-26L4v3czzEkZOK6X23GG-ocQWvwaHTZlx1edU5AByzGQfpX/exec'; // <-- replace with your webapp exec URL
const BASE_FEE = 8499;
const DISC_FEE = 6499;

const totalFeeEl = document.getElementById('totalFee');
const discountEl = document.getElementById('discountAmt');
const payAmtEl = document.getElementById('payAmt');
const sidePayEl = document.getElementById('sidePay');
const appliedTag = document.getElementById('appliedTag');
const payStatusEl = document.getElementById('payStatus');

const applyBtn = document.getElementById('applyBtn');
const couponInput = document.getElementById('coupon');
const packageSelect = document.getElementById('package');

const payBtn = document.getElementById('payBtn');
const submitBtn = document.getElementById('submitBtn');
const resetBtn = document.getElementById('resetBtn');

const okMsg = document.getElementById('okMsg');
const errMsg = document.getElementById('errMsg');

let couponApplied = false;
let currentFinal = BASE_FEE;

// initialize UI
function initUI(){
  const pkg = packageSelect.value || 'FULL_CAMP';
  currentFinal = getPackagePrice(pkg);
  totalFeeEl.textContent = getPackagePrice(pkg);
  discountEl.textContent = '0';
  payAmtEl.textContent = getPackagePrice(pkg);
  sidePayEl.textContent = getPackagePrice(pkg);
  appliedTag.textContent = '—';
  payStatusEl.textContent = 'Not paid';
  submitBtn.disabled = true;
}
initUI();

packageSelect.addEventListener('change', () => {
  // changing package removes coupon
  couponApplied = false;
  couponInput.value = '';
  appliedTag.textContent = '—';
  const p = packageSelect.value;
  const price = getPackagePrice(p);
  currentFinal = price;
  totalFeeEl.textContent = price;
  discountEl.textContent = '0';
  payAmtEl.textContent = price;
  sidePayEl.textContent = price;
});

// coupon apply (server validated)
applyBtn.addEventListener('click', async () => {
  hideMsgs();
  const code = (couponInput.value || '').trim();
  if (!code) { showError('Enter coupon code'); return; }
  // require package selection
  const pkg = packageSelect.value || '';
  if (!pkg) { showError('Select a package first'); return; }

  // optional: pass email/phone so server can check reuse
  const email = (document.getElementById('email').value || '').trim();
  const phone = (document.getElementById('phone').value || '').trim();

  try {
    applyBtn.disabled = true;
    applyBtn.textContent = 'Checking...';
    const url = `${WEB_APP_URL}?action=validateCoupon&coupon=${encodeURIComponent(code)}&package=${encodeURIComponent(pkg)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}`;
    const res = await fetch(url, { method: 'GET' });
    const data = await res.json();
    if (!data || !data.ok) { throw new Error(data && data.error ? data.error : 'Invalid response'); }
    if (data.valid) {
      couponApplied = true;
      currentFinal = data.finalAmount || getPackagePrice(pkg);
      totalFeeEl.textContent = getPackagePrice(pkg);
      discountEl.textContent = (getPackagePrice(pkg) - currentFinal).toString();
      payAmtEl.textContent = currentFinal;
      sidePayEl.textContent = currentFinal;
      appliedTag.textContent = code.toUpperCase();
      showOk('Coupon applied.');
    } else {
      couponApplied = false;
      currentFinal = getPackagePrice(pkg);
      totalFeeEl.textContent = getPackagePrice(pkg);
      discountEl.textContent = '0';
      payAmtEl.textContent = currentFinal;
      sidePayEl.textContent = currentFinal;
      appliedTag.textContent = '—';
      const reason = data.reason || 'Invalid coupon';
      showError(reason);
    }
  } catch (err) {
    console.error('coupon check error', err);
    showError('Coupon validation failed.');
  } finally {
    applyBtn.disabled = false;
    applyBtn.textContent = 'Apply';
  }
});

// Payment flow
payBtn.addEventListener('click', async () => {
  hideMsgs();
  // validate required fields before payment
  const name = (document.getElementById('name').value || '').trim();
  const email = (document.getElementById('email').value || '').trim();
  const phone = (document.getElementById('phone').value || '').trim();
  const cop = (document.getElementById('cop').value || '').trim();
  const pkg = (document.getElementById('package').value || '').trim();
  if (!name || !email || !phone || !cop || !pkg) {
    showError('Please complete name, email, phone, city and package before paying.');
    return;
  }

  // TODO: Replace this simulated flow with PhonePe checkout integration.
  // For now we simulate payment success with a confirm() so you can test end-to-end.
  const confirmPay = confirm('Simulate payment success? (Press OK to simulate success)');
  if (!confirmPay) { showError('Payment cancelled by user'); return; }

  // On real integration you'd call PhonePe SDK/redirect and then on verified success call submitRegistration()
  // For now assume payment succeeded:
  payStatusEl.textContent = 'Payment successful (simulated)';
  // enable submit and immediately submit registration to server (auto-submit after payment)
  submitRegistration();
});

// Submit registration (sends JSON POST to server)
async function submitRegistration(){
  hideMsgs();
  submitBtn.disabled = true;
  submitBtn.textContent = 'Submitting...';

  const payload = {
    name: (document.getElementById('name').value || '').trim(),
    age: (document.getElementById('age').value || '').trim(),
    city: (document.getElementById('city').value || '').trim(),
    email: (document.getElementById('email').value || '').trim(),
    phone: (document.getElementById('phone').value || '').trim(),
    insta: (document.getElementById('insta').value || '').trim(),
    cop: (document.getElementById('cop').value || '').trim(),
    package: (document.getElementById('package').value || '').trim(),
    couponApplied: couponApplied ? '1' : '0',
    coupon: couponApplied ? (couponInput.value || '').trim().toUpperCase() : ''
  };

  try {
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const ct = res.headers.get('content-type') || '';
    if (!ct.includes('application/json')) {
      const txt = await res.text();
      console.error('Server returned non-JSON:', txt);
      throw new Error('Server returned non-JSON response. Check webapp logs.');
    }
    const data = await res.json();
    if (!data.ok) throw new Error(data.error || 'Submission failed');
    // success
    showOk('Registration successful — check your email. Order ID: ' + (data.orderId || 'N/A'));
    // optionally display order id somewhere
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitted';
    payBtn.disabled = true;
  } catch (err) {
    console.error('submit error', err);
    showError('Submission failed: ' + (err.message || err));
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Registration';
  }
}

resetBtn.addEventListener('click', () => {
  document.getElementById('regForm').reset();
  couponInput.value = '';
  couponApplied = false;
  initUI();
  hideMsgs();
});

// helpers
function getPackagePrice(code) {
  const map = {
    'FULL_CAMP': 8499,
    '8_CLASSES': 7699,
    '7_CLASSES': 6799,
    '6_CLASSES': 5799,
    '5_CLASSES': 4799,
    '4_CLASSES': 3899,
    '3_CLASSES': 2999,
    '2_CLASSES': 2199,
    'SINGLE_CLASS': 1200,
    'AKSHAY_STAG': 1199,
    'AKSHAY_COUPLE': 1999
  };
  return map[code] || 8499;
}
function hideMsgs(){ okMsg.style.display='none'; errMsg.style.display='none'; }
function showOk(txt){ okMsg.textContent = txt; okMsg.style.display='block'; errMsg.style.display='none'; }
function showError(txt){ errMsg.textContent = txt; errMsg.style.display='block'; okMsg.style.display='none'; }
</script>
</body>
</html>
