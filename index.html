<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Artist League Camp 2025 – Registration</title>
<style>
  :root{--bg:#0b0b10;--card:#141420;--text:#f5f7ff;--muted:#a8acc3;--accent:#5b8cff;--ok:#1db954;--err:#d9534f}
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:900px;margin:24px auto;padding:16px}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
  .card{background:var(--card);border-radius:16px;padding:18px}
  h1{font-size:22px;margin:0 0 8px}
  label{display:block;font-size:14px;margin:10px 0 6px;color:var(--muted)}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a2a3a;background:#10101a;color:var(--text)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .coupon-bar{display:flex;gap:8px;align-items:center;margin-top:8px}
  .btn{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;color:#fff;background:var(--accent)}
  .btn.secondary{background:#2a2a3a}
  .btn.ok{background:var(--ok)}
  .muted{color:var(--muted);font-size:12px}
  .calc{background:#0f1320;border:1px solid #2a314b;border-radius:12px;padding:12px;margin-top:12px}
  .calc .line{display:flex;justify-content:space-between;margin:6px 0}
  .calc .total{font-weight:700;font-size:18px}
  .qrbox{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:12px}
  .qrbox img{width:220px;height:220px;border-radius:12px;background:#fff}
  .okmsg{margin-top:12px;padding:10px;border-radius:10px;background:#0f1f14;border:1px solid #1e7d3b}
  .errmsg{margin-top:12px;padding:10px;border-radius:10px;background:#2a1414;border:1px solid #7d1e1e}
  .small{font-size:13px;color:var(--muted)}
  @media (max-width:940px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <h1>Artist League Camp 2025 — Registration</h1>
      <form id="regForm" novalidate>
        <div class="row">
          <div>
            <label for="name">Name</label>
            <input id="name" name="name" required />
          </div>
          <div>
            <label for="age">Age</label>
            <input id="age" name="age" type="number" min="5" max="99" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="currentCity">Current City</label>
            <input id="currentCity" name="currentCity" placeholder="Your city" required />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="phone">Phone</label>
            <!-- no pattern attribute — we'll validate in JS -->
            <input id="phone" name="phone" type="tel" inputmode="tel"
                   placeholder="10-digit mobile (or +91 9xxxxxxxxx)"
                   required />
          </div>
          <div>
            <label for="insta">Instagram Profile Link</label>
            <input id="insta" name="insta" placeholder="https://instagram.com/…" />
          </div>
        </div>

        <label for="cop">City of Participation</label>
        <select id="cop" name="cop" required>
          <option value="">Choose…</option>
          <option value="Mumbai">Mumbai</option>
          <option value="Pune">Pune</option>
        </select>

        <label>Coupon Code (optional)</label>
        <div class="coupon-bar">
          <!-- NO example placeholder and no visible coupon list -->
          <input id="coupon" name="coupon" placeholder="" autocomplete="off" />
          <button class="btn" type="button" id="applyBtn">Apply</button>
        </div>
        <div class="small" id="couponHint" style="display:none">Coupon applied</div>

        <div class="calc" id="calcBox">
          <div class="line"><span>Total fee</span><span>₹ <span id="totalFee">8499</span></span></div>
          <div class="line"><span>Discount</span><span>- ₹ <span id="discountAmt">0</span></span></div>
          <div class="line total"><span>Amount payable</span><span>₹ <span id="payAmt">8499</span></span></div>
        </div>

        <label for="screenshot">Upload Payment Screenshot (required — ≤ 100 MB)</label>
        <input id="screenshot" name="screenshot" type="file" accept="image/*,application/pdf" required />
        <div class="small" id="fileStatus" style="margin-top:6px"></div>

        <div class="okmsg" id="okMsg" style="display:none;"></div>
        <div class="errmsg" id="errMsg" style="display:none;"></div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn ok" id="submitBtn" type="submit" disabled>Submit Registration</button>
          <button class="btn secondary" type="button" id="resetBtn">Reset</button>
        </div>
      </form>
    </div>

    <!-- RIGHT: Payment box -->
    <div class="card">
      <h1>Pay via UPI</h1>
      <div style="display:flex;gap:8px;align-items:center;">
        <div class="muted">UPI ID:</div>
        <div id="upiId" style="font-weight:700;">yashmani1996@okhdfcbank</div>
        <button class="btn secondary" type="button" id="copyUpi">Copy</button>
      </div>

      <div class="qrbox">
        <div class="muted" id="qrLabel">Scan to pay ₹8499</div>

        <!-- local images must exist in same folder as this HTML -->
        <img id="qr8499" src="qr8499.png" alt="UPI QR 8499">
        <img id="qr6499" src="qr6499.png" alt="UPI QR 6499" style="display:none;">

        <a id="upiLink" class="btn" href="#" target="_blank" rel="noopener">Open in UPI app</a>
      </div>

      <div class="calc" style="margin-top:16px;">
        <div class="line"><span>Applied coupon</span><span id="appliedTag">—</span></div>
        <div class="line"><span>Payable now</span><span>₹ <span id="sidePay">8499</span></span></div>
      </div>
      <div class="muted" style="margin-top:10px;">Tip: If your phone can’t scan the QR it’s because the QR is on the same phone — use another phone to scan.</div>
    </div>
  </div>
</div>

<script>
/* ========== CONFIG ==========
Paste your deployed Apps Script Web App URL here (the "web app URL" you get from Deploy)
*/
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzymHjYql5GpY5OeGlDyxKL0DWZYu1ff7phJ--d3lOcLADBBPLJd-H18B8Mx-X9m377/exec';
const UPI_ID = 'yashmani1996@okhdfcbank';
const PAYEE_NAME = 'Yash Mani';
const BASE_FEE = 8499;
const DISC_FEE = 6499;

// secret coupon list — NOT shown on web page
const VALID_COUPONS = new Set([
  'AKSHAY2000','MELVIN2000','CHIRAG2000','YASSH2000','YASH2000','MANVI2000',
  'AKANKSHA2000','YAHVI2000','JORDAN2000','NOEL2000','SANKET2000','LEONEL2000'
]);

/* ========== UI refs ========== */
const img8499 = document.getElementById('qr8499');
const img6499 = document.getElementById('qr6499');
const upiLink = document.getElementById('upiLink');
const qrLabel = document.getElementById('qrLabel');
const totalFeeEl = document.getElementById('totalFee');
const discountEl = document.getElementById('discountAmt');
const payAmtEl = document.getElementById('payAmt');
const sidePayEl = document.getElementById('sidePay');
const appliedTag = document.getElementById('appliedTag');
const couponHint = document.getElementById('couponHint');
const fileStatus = document.getElementById('fileStatus');
const submitBtn = document.getElementById('submitBtn');
const okMsg = document.getElementById('okMsg');
const errMsg = document.getElementById('errMsg');

let couponApplied = false;
let appliedCode = '';
let screenshotBase64 = null;
let screenshotName = null;
let screenshotMime = null;

/* initial */
totalFeeEl.textContent = BASE_FEE;
discountEl.textContent = '0';
payAmtEl.textContent = BASE_FEE;
sidePayEl.textContent = BASE_FEE;
upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;

/* handle file input: validate size <= 100MB, convert to base64 */
document.getElementById('screenshot').addEventListener('change', async (ev) => {
  hideMsgs();
  screenshotBase64 = null; screenshotName = null; screenshotMime = null;
  submitBtn.disabled = true;
  const f = ev.target.files && ev.target.files[0];
  if (!f) { fileStatus.textContent = ''; return; }
  const maxBytes = 100 * 1024 * 1024;
  if (f.size > maxBytes) {
    fileStatus.textContent = `File too large (${(f.size/1024/1024).toFixed(1)} MB). Please upload ≤ 100 MB.`;
    showError('Upload failed: file too large.');
    return;
  }
  fileStatus.textContent = `${f.name} (${(f.size/1024).toFixed(0)} KB) — processing...`;
  try {
    const dataUrl = await fileToDataURL(f);
    screenshotBase64 = dataUrl.split(',')[1];
    screenshotName = f.name;
    screenshotMime = f.type || 'application/octet-stream';
    fileStatus.textContent = `${f.name} (${(f.size/1024).toFixed(0)} KB) — ready`;
    submitBtn.disabled = false;
  } catch (err) {
    fileStatus.textContent = 'Failed to read file.';
    showError('Upload failed: unable to read file.');
  }
});

function fileToDataURL(file){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onerror = () => reject(r.error);
    r.onload = () => resolve(r.result);
    r.readAsDataURL(file);
  });
}

/* Apply coupon (client-side) */
document.getElementById('applyBtn').addEventListener('click', () => {
  hideMsgs();
  const code = (document.getElementById('coupon').value || '').trim().toUpperCase();
  if (!code) { showError('Enter a coupon code to apply.'); return; }
  if (VALID_COUPONS.has(code)) {
    couponApplied = true; appliedCode = code;
    discountEl.textContent = (BASE_FEE - DISC_FEE).toString();
    payAmtEl.textContent = DISC_FEE;
    sidePayEl.textContent = DISC_FEE;
    appliedTag.textContent = code;
    img8499.style.display = 'none';
    img6499.style.display = 'block';
    upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${DISC_FEE}&cu=INR`;
    qrLabel.textContent = 'Scan to pay ₹' + DISC_FEE;
    couponHint.style.display = 'block';
    couponHint.textContent = 'Coupon applied';
    showOk('Coupon applied successfully.');
  } else {
    couponApplied = false; appliedCode = '';
    discountEl.textContent = '0';
    payAmtEl.textContent = BASE_FEE;
    sidePayEl.textContent = BASE_FEE;
    appliedTag.textContent = '—';
    img8499.style.display = 'block';
    img6499.style.display = 'none';
    upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;
    qrLabel.textContent = 'Scan to pay ₹' + BASE_FEE;
    couponHint.style.display = 'none';
    showError('Invalid coupon code.');
  }
});

/* copy UPI */
document.getElementById('copyUpi').addEventListener('click', async () => {
  try { await navigator.clipboard.writeText(UPI_ID); showOk('UPI ID copied.'); }
  catch(e){ showError('Could not copy UPI ID.'); }
});

/* reset */
document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('regForm').reset();
  couponApplied=false; appliedCode='';
  totalFeeEl.textContent = BASE_FEE;
  discountEl.textContent = '0';
  payAmtEl.textContent = BASE_FEE;
  sidePayEl.textContent = BASE_FEE;
  appliedTag.textContent = '—';
  img8499.style.display = 'block';
  img6499.style.display = 'none';
  upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;
  qrLabel.textContent = 'Scan to pay ₹' + BASE_FEE;
  fileStatus.textContent = '';
  screenshotBase64 = null; screenshotName = null; screenshotMime = null;
  submitBtn.disabled = true;
  hideMsgs();
});

/* submit: sends JSON string with content-type text/plain to avoid preflight */
document.getElementById('regForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  hideMsgs();

  if (!screenshotBase64 || !screenshotName) {
    showError('Please upload the payment screenshot before submitting.');
    return;
  }

  // JS phone validation (Indian numbers)
  const phoneVal = (document.getElementById('phone').value || '').trim();
  const phonePattern = /^(\+91[\-\s]?)?[6-9]\d{9}$/;
  if (!phonePattern.test(phoneVal)) {
    showError('Please enter a valid Indian mobile number (10 digits, or +91...).');
    document.getElementById('phone').focus();
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Submitting...';

  const payload = {
    name: (document.getElementById('name').value || '').trim(),
    age: (document.getElementById('age').value || '').trim(),
    currentCity: (document.getElementById('currentCity').value || '').trim(),
    email: (document.getElementById('email').value || '').trim(),
    phone: phoneVal,
    instagram: (document.getElementById('insta').value || '').trim(),
    participationCity: (document.getElementById('cop').value || '').trim(),
    coupon: appliedCode || '',
    finalAmountClient: couponApplied ? DISC_FEE : BASE_FEE,
    screenshotBase64: screenshotBase64,
    screenshotName: screenshotName,
    screenshotMime: screenshotMime
  };

  try {
    if (!WEB_APP_URL || WEB_APP_URL.indexOf('http') !== 0) {
      throw new Error('Missing or invalid WEB_APP_URL in HTML. Paste your Apps Script web app URL into the script.');
    }
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: {'Content-Type':'text/plain'}, // intentionally text/plain to avoid preflight
      body: JSON.stringify(payload)
    });

    // parse response (Apps Script returns JSON)
    const data = await res.json();
    if (!data.ok) throw new Error(data.error || 'Server returned error');

    showOk(`Submitted. Final Amount: ₹${data.finalAmount || payload.finalAmountClient}`);
    // clear file input
    document.getElementById('screenshot').value = '';
    fileStatus.textContent = '';
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Registration';
  } catch (err) {
    // most common errors: network, CORS/preflight, incorrect web app URL or permissions
    showError('Submission failed: ' + (err.message || err));
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Registration';
  }
});

/* utility UI */
function showOk(t){ okMsg.style.display='block'; okMsg.textContent=t; errMsg.style.display='none'; }
function showError(t){ errMsg.style.display='block'; errMsg.textContent=t; okMsg.style.display='none'; }
function hideMsgs(){ okMsg.style.display='none'; errMsg.style.display='none'; }
</script>
</body>
</html>
