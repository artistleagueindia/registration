<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Artist League Camp 2025 — Registration</title>
  <style>
    :root{--bg:#0b0b10;--card:#141420;--text:#f5f7ff;--muted:#a8acc3;--accent:#5b8cff;--ok:#1db954;--warn:#ffb020}
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:22px auto;padding:18px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--card);border-radius:16px;padding:18px;box-sizing:border-box}
    h1{font-size:20px;margin:0 0 12px}
    label{display:block;font-size:13px;margin:10px 0 6px;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a2a3a;background:#10101a;color:var(--text);box-sizing:border-box}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .coupon-bar{display:flex;gap:8px;align-items:center;margin-top:6px}
    .btn{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;color:#fff;background:var(--accent)}
    .btn.secondary{background:#2a2a3a}
    .btn.ok{background:var(--ok)}
    .muted{color:var(--muted);font-size:13px}
    .calc{background:#0f1320;border:1px solid #2a314b;border-radius:12px;padding:12px;margin-top:12px}
    .calc .line{display:flex;justify-content:space-between;margin:6px 0}
    .calc .total{font-weight:700;font-size:18px}
    .qrbox{display:flex;flex-direction:column;align-items:center;gap:14px;margin-top:12px}
    .qrbox img{width:220px;height:220px;border-radius:12px;background:#fff;display:block}
    .okmsg{margin-top:12px;padding:10px;border-radius:10px;background:#0f1f14;border:1px solid #1e7d3b}
    .errmsg{margin-top:12px;padding:10px;border-radius:10px;background:#2a1414;border:1px solid #7d1e1e}
    .file-info{font-size:13px;color:var(--muted);margin-top:8px}
    @media (max-width:940px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="grid">
    <!-- LEFT: form -->
    <div class="card">
      <h1>Artist League Camp 2025 — Registration</h1>
      <form id="regForm" autocomplete="on" novalidate>
        <div class="row">
          <div>
            <label for="name">Name</label>
            <input id="name" name="name" required />
          </div>
          <div>
            <label for="age">Age</label>
            <input id="age" name="age" type="number" min="5" max="99" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="city">Current City</label>
            <input id="city" name="city" placeholder="" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="phone">Phone</label>
            <input id="phone" name="phone" inputmode="tel" pattern="[0-9]{10,}" title="Enter at least 10 digits" placeholder="10+ digits" required />
          </div>
          <div>
            <label for="insta">Instagram Profile Link</label>
            <input id="insta" name="insta" placeholder="https://instagram.com/…" />
          </div>
        </div>

        <label for="cop">City of Participation</label>
        <select id="cop" name="cop" required>
          <option value="">Choose…</option>
          <option value="MUMBAI">Mumbai</option>
          <option value="PUNE">Pune</option>
        </select>

        <label>Coupon Code (optional)</label>
        <div class="coupon-bar">
          <input id="coupon" name="coupon" placeholder="" />
          <button class="btn" type="button" id="applyBtn">Apply</button>
        </div>
        <div class="muted" style="margin-top:6px">Coupon list is private and validated server-side.</div>

        <div class="calc" id="calcBox">
          <div class="line"><span>Total fee</span><span>₹ <span id="totalFee">8499</span></span></div>
          <div class="line"><span>Discount</span><span>- ₹ <span id="discountAmt">0</span></span></div>
          <div class="line total"><span>Amount payable</span><span>₹ <span id="payAmt">8499</span></span></div>
        </div>

        <label for="screenshot">Upload Payment Screenshot (required — ≤ 100 MB)</label>
        <input id="screenshot" name="screenshot" type="file" accept="image/*,application/pdf" required />
        <div class="file-info" id="fileInfo">No file chosen</div>

        <div class="okmsg" id="okMsg" style="display:none;"></div>
        <div class="errmsg" id="errMsg" style="display:none;"></div>

        <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn ok" type="submit" id="submitBtn">Submit Registration</button>
          <button class="btn secondary" type="button" id="resetBtn">Reset</button>
        </div>
      </form>
    </div>

    <!-- RIGHT: payment box -->
    <div class="card">
      <h1>Pay via UPI</h1>

      <div class="muted" style="margin-bottom:8px">UPI ID: <span style="font-weight:700">yashmani1996@okhdfcbank</span>
        <button class="btn secondary" type="button" id="copyUpi" style="margin-left:8px">Copy</button>
      </div>

      <div class="qrbox">
        <div class="muted" id="qrLabel">Scan to pay ₹8499</div>

        <img id="qr8499" src="data:image/png;base64,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%01%C2%00%00%01%C2%01%00%00%00%00Tc%F4%E8%00%00%03%85IDATx%9C%ED%9C%5D%8A%A4J%10FO%8CB%3F%2A%CC%02z%29%BA%83%5E%D2%ACiv%A0K%E9%05%0C%E8cCJ%CCCFjZ%B7%E1%C2L%15%5DU%F3%C5%83%94%A5%874%E1%23%FE%D2%D4%9C%3F%B3%F9%DB%1F%82%20R%A4H%91%22E%8A%14y%7F%A4%85%B5%98%F5%9B%E5%C3%B8%9A%C1%DA%E6%AB%B0%96%BB%C6%2F~Z%91wI%0E%EE%EE%BE%80%FB%D28%C3%02%3E%D1%B8Y%1F%FF%D9H%E3%EE%EE~%26%BF%E2iE%DE%25%B9%16%FF2%5Bx%1F%E6~3%E08%80%99%B5%D7%1BS%E4s%90%ED%C5%B9%0DK%0F%F3%AB%E7_%3E%BF%FDj%0D%9A%04%EB%B5%C6%14%F9%E4%E4%DC%03%C3%7B%9BcY%F9w%2BY%D0M%C6%14%F9%14d%E7%EE%13%C0%B04%0E%DD%87%D9%C8f6%AE%2FU%16%E4%EE%E9%1E%9EV%E4%1D%92%B3%99%99%F5%FB%DF%EB%8B%03%91%5D%DB%B8%B6%00%9BE%85v%9D1E%3E%09%99%F3%A1z%C1%A3%FB0%E8%12%CC%3D%E6%AC%9B9%7C%18t%E7e%91%C7%9A%A7%C8%5B%936%02%A5%21%F4%E2%3E%AD-%EEK%DCc%23%8D%1F%AE%CA%C6%AB%8C%29%F2YH%22%D9%E9%12q%A04%89%E8%D2%A9q%94%EF%F3%B0%E9%B1%E6%29%F2v%24%21%89%25%9A%8A%E1%7D%3A%F7%C8%AEsg1E%996%2C%8D4%24%F2%C2B%11%80O%C5%F1D%99%96k%B5%C6%19%3C%C1%90%85%B4%13%8F5O%91%B7%23%23F%ED%8B%1BU%40%9B%8E%D0%E6%29%C7%B7X%09%91%86D%D6%E6%B5%15%A9L%F9Z%84%B1%B0%12%DF%E4%87D%9E%ED%C8%95%2Bg4%2C%94n%23%00%5D%CAn%29%9C%914%24%B2%B6%12%CBJ%8C%8A%9C%3AE%04%0B%E5%10%15Z%A4G%D2%90%C8%CA%C2%ABtu%E5U%24%15%99t%3E%C0%EE%A5%A4%21%91%B5%1D%C9Pi%12%B9%1FI%D1Q%97%E5%CC%28~IC%22%2B%3B%E4S%FAC%CD%DETL%7BIFN%8F%E2%16iHdm%25%96y%DD%98%DE%CB%FA%E2%96%A8j%7BiH%E4%D9%2A%3F%94%23X%96O%F8%1C8%BD%01%5B%02%9A4%24%B2%B2%A8%CB%F6%3C%27NK%2F%E8%EC%91%D4%1F%12%F9%89%1D%ED%C5%7C%3AuERSW.%0C%0B%BB%97riH%E4%85%85%24%96%7D%BDl%81%B2%04K%7D%9A%95%03%8Ae%22%2F%EC%F0C%B1%C2%B1%FB%A1%3A%93%26%EA%B2JM%8F5O%91%B7%23Ok%1D%A7%EC%3A%3A%8B%9D%97%0Edw%CA%9B%A4%21%91%C5%8EXvZ%2F%3B%0E%FB%9B%F8%5D%9DvKC%22%8B%ED%FB%CB%9A%C4%FC%9AZ%F6%FD%88%3E%BF%26%3C%EF4%FB%D9%E7%9Bl%F8%F9%BD%D4i%8F5O%91%B7%23%B3%86%8C%EE%C3%9C%B5%28j%EE1%E8%B6%160%1CR%CB~%D5%86%E9%AB%9EV%E4%3D%92%E7%F7%87%8E%0E%D0%7Fj%FB%C8%96%B4%D6%21%F2s%F2%F8%EE%07s%FE%EE%07%D8%8F%F7%16%E6%BC%C1%BE%F1%EC%87%F6%15%FC%C7%9C%A7%C8%5B%90%7B%9F%DA%FDX%EB8%96VK%99%86%FC%90%C8%FF%23%CBw%3F%AA%3D%AD%23%9B%E5%7D%AE%F6%EAy%7FYl%7B%BD%D2%98%22%9F%83%BC%FC%EE%87%CFo%0B68%C0%DA%E3%B35%0E%AB%E1%F3%D8%24%40%B1L%E4%85%5Dj%88%E1%BDM%C0%D6%FA%FCV%97%FA%06%9B9%EB%F7%E4%7F%3B%A6%C8%E7%22%3F%CD%87%C2%AA%BDA%A76%A4%F2%21%91%27%8B%D49%5Bl%E4%C89u~%2F%0D%AA%D7%F1%EB%B7%F3%1Fk%9E%22oG%9A%BEq.R%A4H%91%22E%8A%FC%C7%C9%DF%E6E%9Ar%27%88%DDy%00%00%00%00IEND%AEB%60%82" alt="QR 8499">

        <img id="qr6499" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAHCAQAAAABUY/ToAAADhUlEQVR4nO2cXYqkShBGT4xCPyrMAnopuoNe0qxpdqBL6QUM6GNDSsxDRmpat+HCTBVdVfPFg5SlhzThI/7S1Jw/s/nbH4IgUqRIkSJFihR5f6SFtZj1m+XDuJrB2uarsJa7xi9+WpF3SQ7u7r6A+9I4wwI+0bhZH//ZSOPu7n4mv+JpRd4luRb/Mlt4H+Z+M+A4gJm11xtT5HOQ7cW5DUsP86vnXz6//WoNmgTrtcYU+eTk3APDe5tjWfl3K1nQTcYU+RRk5+4TwLA0Dt2H2chmNq4vVRbk7ukenlbkHZKzmZn1+9/riwORXdu4tgCbRYV2nTFFPgmZ86F6waP7MOgSzD3mrJs5fBh052WRx5qnyFuTNgKlIfTiPq0t7kvcYyONH67KxquMKfJZSCLZ6RJxoDSJ6NKpcZTv87DpseYp8nYkIYklmorhfTr3yK5zZzFFmTYsjTQk8sJCEYBPxfFEmZZrtcYZPMGQhbQTjzVPkbcjI0btixtVQJuO0OYpx7dYCZGGRNbmtRWpTPlahLGwEt/kh0Se7ciVK2c0LJRuIwBdym4pnJE0JLK2EstKjIqcOkUEC+UQFVqkR9KQyMrCq3R15VUkFZl0PsDupaQhkbUdyVBpErkfSdFRl+XMKH5JQyIrO+RT+kPN3lRMe0lGTo/iFmlIZG0llnndmN7L+uKWqGp7aUjk2So/lCNYlk/4HDi9AVsCmjQksrKoy/Y8J05LL+jskdQfEvmJHe3FfDp1RVJTVy4MC7uXcmlI5IWFJJZ9vWyBsgRLfZqVA4plIi/s8EOxwrH7oTqTJuqySk2PNU+RtyNPax2n7Do6i52XDmR3ypukIZHFjlh2Wi87Dvub+F2ddktDIovt+8uaxPyaWvb9iD6/JjzvNPvZ55ts+Pm91GmPNU+RtyOzhozuw5y1KGruMei2FjAcUst+1Ybpq55W5D2S5/eHjg7Qf2r7yJa01iHyc/L47gdz/u4H2I/3Fua8wb7x7If2FfzHnKfIW5B7n9r9WOs4llZLmYb8kMj/I8t3P6o9rSOb5X2u9up5f1lse73SmCKfg7z87ofPbws2OMDa47M1Dqvh89gkQLFM5IVdaojhvU3A1vr8Vpf6Bps56/fkfzumyOciP82Hwqq9Qac2pPIhkSeL1DlbbOTIOXV+Lw2q1/Hrt/Mfa54ib0eavnEuUqRIkSJFivzHyd/mRZpyJ4jdeQAAAABJRU5ErkJggg==" alt="QR 6499" style="display:none">

        <a id="upiLink" class="btn" href="#" target="_blank" rel="noopener">Open in UPI app</a>
      </div>

      <div class="calc" style="margin-top:16px">
        <div class="line"><span>Applied coupon</span><span id="appliedTag">—</span></div>
        <div class="line"><span>Payable now</span><span>₹ <span id="sidePay">8499</span></span></div>
      </div>

      <div class="muted" style="margin-top:10px">Tip: If your phone can’t scan the QR it’s because the QR is on the same phone — use another phone to scan.</div>
    </div>
  </div>
</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby0-5YZeZhdbCRB7uEP4tEyJzQyDNShqos5f-KyVgynnyCGJWQoS0UC5bp75XXwWqhYDQ/exec';
const UPI_ID = 'yashmani1996@okhdfcbank';
const PAYEE_NAME = 'Yash Mani';
const BASE_FEE = 8499;
const DISC_FEE = 6499;
const SUBMIT_MAX_BYTES = 100 * 1024 * 1024;

const totalFeeEl = document.getElementById('totalFee');
const discountEl = document.getElementById('discountAmt');
const payAmtEl = document.getElementById('payAmt');
const sidePayEl = document.getElementById('sidePay');
const appliedTag = document.getElementById('appliedTag');
const qrLabel = document.getElementById('qrLabel');
const qr8499 = document.getElementById('qr8499');
const qr6499 = document.getElementById('qr6499');
const upiLink = document.getElementById('upiLink');
const applyBtn = document.getElementById('applyBtn');
const couponInput = document.getElementById('coupon');
const screenshotInput = document.getElementById('screenshot');
const fileInfo = document.getElementById('fileInfo');
const okMsg = document.getElementById('okMsg');
const errMsg = document.getElementById('errMsg');
const submitBtn = document.getElementById('submitBtn');

let couponApplied = false;
let currentFinal = BASE_FEE;

function hideMsgs(){ okMsg.style.display='none'; errMsg.style.display='none'; }
function showOk(txt){ okMsg.textContent = txt; okMsg.style.display = 'block'; errMsg.style.display = 'none'; }
function showError(txt){ errMsg.textContent = txt; errMsg.style.display = 'block'; okMsg.style.display = 'none'; }

document.getElementById('copyUpi').addEventListener('click', async () => {
  try{ await navigator.clipboard.writeText(UPI_ID); showOk('UPI ID copied.'); } catch(e){ showError('Could not copy UPI ID.'); }
});

screenshotInput.addEventListener('change', () => {
  hideMsgs();
  const f = screenshotInput.files[0];
  if(!f){ fileInfo.textContent = 'No file chosen'; submitBtn.disabled = true; return; }
  if(f.size > SUBMIT_MAX_BYTES){
    fileInfo.textContent = `${f.name} (${Math.round(f.size/1024)} KB) — too large ( >100 MB ).`;
    showError('File too large. Upload ≤ 100 MB.');
    submitBtn.disabled = true;
    return;
  }
  fileInfo.textContent = `${f.name} (${Math.round(f.size/1024)} KB) — ready`;
  submitBtn.disabled = false;
});

applyBtn.addEventListener('click', async () => {
  hideMsgs();
  const code = (couponInput.value || '').trim();
  if(!code){ showError('Enter a coupon code to apply.'); return; }

  try{
    applyBtn.disabled = true;
    applyBtn.textContent = 'Checking...';
    const res = await fetch(`${WEB_APP_URL}?action=validateCoupon&coupon=${encodeURIComponent(code)}`, { method:'GET' });
    const data = await res.json();
    if(!data || !data.ok) throw new Error(data.error || "Invalid response");
    if(data.valid){
      couponApplied = true;
      currentFinal = data.finalAmount || DISC_FEE;
      totalFeeEl.textContent = BASE_FEE;
      discountEl.textContent = (BASE_FEE - currentFinal).toString();
      payAmtEl.textContent = currentFinal;
      sidePayEl.textContent = currentFinal;
      appliedTag.textContent = code.toUpperCase();
      qr8499.style.display = 'none';
      qr6499.style.display = 'block';
      upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${currentFinal}&cu=INR`;
      qrLabel.textContent = `Scan to pay ₹${currentFinal}`;
      showOk('Coupon applied successfully.');
    } else {
      couponApplied = false;
      currentFinal = BASE_FEE;
      totalFeeEl.textContent = BASE_FEE;
      discountEl.textContent = '0';
      payAmtEl.textContent = BASE_FEE;
      sidePayEl.textContent = BASE_FEE;
      appliedTag.textContent = '—';
      qr8499.style.display = 'block';
      qr6499.style.display = 'none';
      upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;
      qrLabel.textContent = `Scan to pay ₹${BASE_FEE}`;
      showError('Invalid coupon code.');
    }
  } catch(err){ console.error('coupon check error', err); showError('Coupon validation failed. Try again.'); }
  finally { applyBtn.disabled = false; applyBtn.textContent = 'Apply'; }
});

document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('regForm').reset();
  hideMsgs();
  couponApplied = false;
  appliedTag.textContent = '—';
  currentFinal = BASE_FEE;
  totalFeeEl.textContent = BASE_FEE;
  discountEl.textContent = '0';
  payAmtEl.textContent = BASE_FEE;
  sidePayEl.textContent = BASE_FEE;
  qr8499.style.display = 'block';
  qr6499.style.display = 'none';
  upiLink.href = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;
  fileInfo.textContent = 'No file chosen';
  submitBtn.disabled = false;
});

document.getElementById('regForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  hideMsgs();

  const file = screenshotInput.files[0];
  if(!file){ showError('Upload payment screenshot. Submission disabled until file is selected.'); return; }
  if(file.size > SUBMIT_MAX_BYTES){ showError('File too large (>100MB). Upload smaller file.'); return; }

  const name = (document.getElementById('name').value || '').trim();
  const email = (document.getElementById('email').value || '').trim();
  const cop = (document.getElementById('cop').value || '').trim();
  if(!name || !email || !cop){ showError('Complete name, email and city of participation.'); return; }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Submitting...';

  try {
    const fd = new FormData(ev.target);
    fd.append('finalAmountClient', couponApplied ? currentFinal : BASE_FEE);
    fd.append('couponApplied', couponApplied ? '1' : '0');

    const res = await fetch(WEB_APP_URL, { method: 'POST', body: fd });
    const contentType = res.headers.get('content-type') || '';
    if(!contentType.includes('application/json')){
      const txt = await res.text();
      console.error('Unexpected server response:', txt);
      throw new Error('Server returned non-JSON response. Check deployment & logs.');
    }

    const data = await res.json();
    if(!data.ok) throw new Error(data.error || 'Submission failed');

    showOk(`Submitted. Final Amount: ₹${data.finalAmount || fd.get('finalAmountClient')}`);
    if(data.driveLink){
      fileInfo.innerHTML = `File saved: <a href="${data.driveLink}" target="_blank" rel="noopener">${data.driveLink}</a>`;
    }

    screenshotInput.value = '';
  } catch(err){
    console.error('submit error', err);
    showError('Submission failed: ' + (err.message || err));
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Registration';
  }
});
</script>
</body>
</html>
