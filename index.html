<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Artist League Camp 2025 — Register & Pay</title>
<style>
  /* keep the same polished styling you had — simplified here */
  body{font-family:Inter,Arial,sans-serif;background:#0b0b10;color:#f5f7ff;margin:0;padding:20px}
  .wrap{max-width:900px;margin:0 auto;display:grid;grid-template-columns:1fr 380px;gap:16px}
  .card{background:#141420;padding:18px;border-radius:12px}
  label{display:block;margin:8px 0 4px;color:#a8acc3;font-size:13px}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #2a2a3a;background:#0f1016;color:#f5f7ff}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .coupon-bar{display:flex;gap:8px;align-items:center}
  button{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;background:#5b8cff;color:#fff}
  .btn-secondary{background:#2a2a3a}
  .muted{color:#a8acc3;font-size:13px}
  .calc{background:#0f1320;padding:10px;border-radius:8px;margin-top:12px;border:1px solid #2a314b}
  .qrbox{display:flex;flex-direction:column;align-items:center;gap:10px}
  img.qr{width:220px;height:220px;border-radius:10px;background:#fff}
  .msg{padding:10px;border-radius:8px;margin-top:8px}
  .ok{background:#0f1f14;border:1px solid #1e7d3b;color:#bff2c7}
  .err{background:#2a1414;border:1px solid #7d1e1e;color:#ffcfcf}
  @media (max-width:940px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>Artist League Camp 2025 — Registration</h2>
    <form id="regForm">
      <div class="row">
        <div>
          <label for="name">Name</label>
          <input id="name" name="name" required>
        </div>
        <div>
          <label for="age">Age</label>
          <input id="age" name="age" type="number" min="5" max="99" required>
        </div>
      </div>

      <label for="currentCity">Current City</label>
      <input id="currentCity" name="currentCity" placeholder="Your current city">

      <label for="email">Email</label>
      <input id="email" name="email" type="email" required>

      <label for="phone">Phone</label>
      <input id="phone" name="phone" inputmode="numeric" pattern="\\d{10,}" placeholder="10+ digits" required>

      <label for="insta">Instagram Profile Link</label>
      <input id="insta" name="instagram" placeholder="https://instagram.com/...">

      <label for="cop">Select City of Participation</label>
      <select id="cop" name="cop" required>
        <option value="">Choose…</option>
        <option>Mumbai</option>
        <option>Pune</option>
      </select>

      <label>Coupon Code (optional)</label>
      <div class="coupon-bar">
        <input id="coupon" name="coupon" placeholder="Enter coupon code (secret)">
        <button type="button" id="applyBtn">Apply</button>
      </div>

      <div class="calc" id="calcBox">
        <div style="display:flex;justify-content:space-between"><span>Total fee</span><strong>₹<span id="totalFee">8499</span></strong></div>
        <div style="display:flex;justify-content:space-between"><span>Discount</span><strong>- ₹<span id="discountAmt">0</span></strong></div>
        <div style="display:flex;justify-content:space-between;margin-top:6px"><span>Amount payable</span><strong>₹<span id="payAmt">8499</span></strong></div>
      </div>

      <label for="screenshot">Upload Payment Screenshot (≤ 100MB)</label>
      <input id="screenshot" name="screenshot" type="file" accept="image/*,application/pdf">

      <div id="okMsg" class="msg ok" style="display:none"></div>
      <div id="errMsg" class="msg err" style="display:none"></div>

      <div style="margin-top:10px;display:flex;gap:8px">
        <button type="submit">Submit Registration</button>
        <button type="button" class="btn-secondary" id="resetBtn">Reset</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Pay via UPI</h2>
    <div style="display:flex;align-items:center;gap:10px">
      <div class="muted">UPI ID:</div>
      <div style="font-weight:700">yashmani1996@okhdfcbank</div>
      <button id="copyUpi" class="btn-secondary">Copy</button>
    </div>

    <div class="qrbox">
      <div id="qrLabel" class="muted">Scan to pay ₹8499</div>
      <!-- Replace these src values if you host different filenames -->
      <img id="qr8499" class="qr" src="qr8499.png" alt="QR ₹8499">
      <img id="qr6499" class="qr" src="qr6499.png" alt="QR ₹6499" style="display:none">
      <a id="upiLink" class="btn" href="#" target="_blank" rel="noopener">Open in UPI app</a>
    </div>

    <div class="calc" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between"><span>Applied coupon</span><strong id="appliedTag">—</strong></div>
      <div style="display:flex;justify-content:space-between"><span>Payable now</span><strong>₹<span id="sidePay">8499</span></strong></div>
    </div>
    <div class="muted" style="margin-top:10px">Tip: If your phone can’t scan the QR (same phone), use another phone to scan the code.</div>
  </div>
</div>

<script>
/* --------------- CONFIG --------------- */
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzQyYV2o8gw6y4Hd9a_qBum0YOYEJ0x134z5QXx2JwSRtV8v76dHwXciUJmH1xheCZU/exec'; // <-- paste your Apps Script exec URL here
const BASE_FEE = 8499;
const DISC_FEE = 6499;
const VALID_COUPONS = ['AKSHAY2000','MELVIN2000','CHIRAG2000','YASSH2000','YASH2000','MANVI2000','AKANKSHA2000','YAHVI2000','JORDAN2000','NOEL2000','SANKET2000','LEONEL2000'];
const MAX_FILE_BYTES = 100 * 1024 * 1024; // 100MB

/* --------------- UI refs --------------- */
const totalFeeEl = document.getElementById('totalFee');
const discountEl = document.getElementById('discountAmt');
const payAmtEl = document.getElementById('payAmt');
const sidePayEl = document.getElementById('sidePay');
const appliedTag = document.getElementById('appliedTag');
const qrLabel = document.getElementById('qrLabel');
const img8499 = document.getElementById('qr8499');
const img6499 = document.getElementById('qr6499');
const upiLink = document.getElementById('upiLink');
const okMsg = document.getElementById('okMsg');
const errMsg = document.getElementById('errMsg');

let couponApplied = false;
let appliedCode = '';

// UPI deep links (used by "Open in UPI app" button)
const UPI_ID = 'yashmani1996@okhdfcbank';
const PAYEE_NAME = 'Yash Mani';
const upi8499 = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${BASE_FEE}&cu=INR`;
const upi6499 = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${DISC_FEE}&cu=INR`;
upiLink.href = upi8499;

/* --------------- coupon apply --------------- */
document.getElementById('applyBtn').addEventListener('click', () => {
  hideMsgs();
  const code = (document.getElementById('coupon').value || '').trim().toUpperCase();
  if (!code) { showError('Enter a coupon code to apply.'); return; }
  if (VALID_COUPONS.includes(code)) {
    couponApplied = true; appliedCode = code;
    discountEl.textContent = (BASE_FEE - DISC_FEE).toString();
    payAmtEl.textContent = DISC_FEE;
    sidePayEl.textContent = DISC_FEE;
    appliedTag.textContent = code;
    img8499.style.display = 'none';
    img6499.style.display = '';
    upiLink.href = upi6499;
    qrLabel.textContent = 'Scan to pay ₹6499';
    showOk('Coupon applied successfully.');
  } else {
    couponApplied = false; appliedCode = '';
    discountEl.textContent = '0';
    payAmtEl.textContent = BASE_FEE;
    sidePayEl.textContent = BASE_FEE;
    appliedTag.textContent = '—';
    img8499.style.display = '';
    img6499.style.display = 'none';
    upiLink.href = upi8499;
    qrLabel.textContent = 'Scan to pay ₹8499';
    showError('Invalid coupon code.');
  }
});

/* --------------- copy UPI --------------- */
document.getElementById('copyUpi').addEventListener('click', async () => {
  try {
    await navigator.clipboard.writeText(UPI_ID);
    showOk('UPI ID copied to clipboard.');
  } catch (err) { showError('Failed to copy UPI ID.'); }
});

/* --------------- form submit --------------- */
document.getElementById('regForm').addEventListener('submit', async (ev) => {
  ev.preventDefault(); hideMsgs();

  const form = ev.target;
  const fileInput = document.getElementById('screenshot');
  const file = fileInput.files[0];

  if (!file) {
    showError('Please upload payment screenshot before submitting.');
    return;
  }
  if (file.size > MAX_FILE_BYTES) {
    showError('File too large. Please upload a file smaller than 100 MB.');
    return;
  }

  // Build FormData matching server expectations
  const fd = new FormData(form);
  fd.set('finalAmountClient', couponApplied ? DISC_FEE : BASE_FEE);
  // file input is already included by FormData since <input name="screenshot"> exists

  try {
    const res = await fetch(WEB_APP_URL, { method: 'POST', body: fd });
    const json = await res.json();
    if (json.ok) {
      showOk(json.message || `Submitted. Final Amount: ₹${json.finalAmount}`);
      // Optional: clear file input
      fileInput.value = '';
      // reset coupon? keep applied state - up to you
    } else {
      showError('Submission failed: ' + (json.error || 'Unknown error'));
    }
  } catch (err) {
    showError('Submission failed (network): ' + err.message);
    console.error(err);
  }
});

/* --------------- reset --------------- */
document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('regForm').reset();
  couponApplied = false; appliedCode = '';
  discountEl.textContent = '0';
  payAmtEl.textContent = BASE_FEE;
  sidePayEl.textContent = BASE_FEE;
  appliedTag.textContent = '—';
  img8499.style.display = '';
  img6499.style.display = 'none';
  upiLink.href = upi8499;
  qrLabel.textContent = 'Scan to pay ₹8499';
  hideMsgs();
});

/* --------------- UI helpers --------------- */
function hideMsgs(){ okMsg.style.display='none'; errMsg.style.display='none'; }
function showOk(t){ okMsg.textContent = t; okMsg.style.display='block'; errMsg.style.display='none'; }
function showError(t){ errMsg.textContent = t; errMsg.style.display='block'; okMsg.style.display='none'; }

</script>
</body>
</html>
